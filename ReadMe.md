# BunnyAuthåŠ¨æ€æƒé™æ§åˆ¶ç®€ä»‹

> [!IMPORTANT]
>
> å‰ç«¯é¡¹ç›®æ•´ä½“éƒ½ç”±æ­¤æ¨¡æ¿å¼€å‘
>
> é¡¹ç›®ç”±[å°é“­](https://github.com/xiaoxian521)å¼€æºæƒé™æ¨¡æ¿[Pure-admin](https://pure-admin.github.io/vue-pure-admin/)
>
> **Pure-adminæ–‡æ¡£**ï¼šhttps://pure-admin.github.io/pure-admin-doc

> [!TIP]
>
> é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªé»˜è®¤ç®¡ç†å‘˜ï¼Œæ•°æ®åº“ä¸­ç”¨æˆ·`id`æ˜¯`1`ï¼š
>
> ç”¨æˆ·åï¼š`Administrator`
>
> å¯†ç ï¼š`admin123`

> [!WARNING]
>
> å¦‚æœåˆšåˆå§‹åŒ–ç™»å½•çš„æ—¶å€™ï¼Œå‘ç°ç®¡ç†å‘˜ã€`Administrator`ã€‘å¯†ç é”™è¯¯ã€‚
>
> æ‰¾åˆ°æ•°æ®åº“`sys_user`ï¼Œå°†`Administrator`æ›¿æ¢æˆä¸‹é¢çš„å¯†ç ã€‚
>
> `$2a$10$h5BUwmMaVcEuu7Bz0TPPy.PQV8JP6CFJlbHTgT78G1s0YPIu2kfXe`

## è§†é¢‘è¯´æ˜åœ°å€

**ä»‹ç»è§†é¢‘è§†é¢‘**

- [ç¯å¢ƒæ­å»º](https://www.bilibili.com/video/BV17odHY6E3S/?spm_id_from=333.1387.homepage.video_card.click&vd_source=d42b5b664efb958be39eef8ee1196a7e)
- [è¿è¡Œé¡¹ç›®](https://www.bilibili.com/video/BV1qodHYzErA/?spm_id_from=333.1387.homepage.video_card.click&vd_source=d42b5b664efb958be39eef8ee1196a7e)
- [å‰ç«¯éƒ¨ç½²](https://www.bilibili.com/video/BV1BddHYgEPq/?spm_id_from=333.1387.homepage.video_card.click&vd_source=d42b5b664efb958be39eef8ee1196a7e)
- [åç«¯éƒ¨ç½²](https://www.bilibili.com/video/BV1BddHYgEFt/?spm_id_from=333.1387.homepage.video_card.click&vd_source=d42b5b664efb958be39eef8ee1196a7e)
- [ä»£ç ç”Ÿæˆå™¨](https://www.bilibili.com/video/BV1d4Lxz9E3j/?vd_source=d42b5b664efb958be39eef8ee1196a7e)

**Githubåœ°å€**

- æƒé™åç«¯ï¼šhttps://github.com/BunnyMaster/bunny-admin-server
- æƒé™å‰ç«¯ï¼šhttps://github.com/BunnyMaster/bunny-admin-web
- ä»£ç ç”Ÿæˆå™¨ç«¯ï¼šhttps://github.com/BunnyMaster/generator-code-server

**Giteeåœ°å€**

- æƒé™åç«¯ï¼šhttps://gitee.com/BunnyBoss/bunny-admin-server
- æƒé™å‰ç«¯ï¼šhttps://gitee.com/BunnyBoss/bunny-admin-web
- ä»£ç ç”Ÿæˆå™¨ç«¯ï¼šhttps://gitee.com/BunnyBoss/generator-code-server

## ğŸš€ é¡¹ç›®ç®€ä»‹

ä¸€ä¸ªåŸºäº Spring Security 6 çš„ç°ä»£åŒ–åŠ¨æ€æƒé™æ§åˆ¶ç³»ç»Ÿï¼Œæä¾›å®Œæ•´çš„ RBAC æƒé™ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚æ”¯æŒå‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå¯çµæ´»é…ç½®ç»†ç²’åº¦æƒé™æ§åˆ¶ã€‚

## âœ¨ v4.0.0 é‡å¤§æ›´æ–°

### æ ¸å¿ƒæ”¹è¿›

- **å…¨é¢é‡æ„**ï¼šåç«¯æ¥å£ã€å®ä½“ç±»ç­‰é‡æ„ï¼Œå‰ç«¯é‡æ„éƒ¨åˆ†j+ä¼˜åŒ–æ“ä½œä½“éªŒ
- **æ‰¹é‡æ“ä½œæ”¯æŒ**ï¼š
  - âœ…èœå•ç®¡ç†ï¼šå®Œå–„å±æ€§å†…å®¹
  - âœ… æƒé™ç®¡ç†ï¼šæ”¯æŒ JSON/Excel å¯¼å…¥å¯¼å‡º
  - âœ… è§’è‰²ç®¡ç†ï¼šæ”¯æŒ Excel æ‰¹é‡æ›´æ–°
  - âœ… å¤šè¯­è¨€é…ç½®ï¼šæ”¯æŒ JSON/Excel æ›´æ–°ï¼ˆå…¨é‡æ›¿æ¢æ¨¡å¼ï¼‰

### æŠ€æœ¯äº®ç‚¹

- **æ³¨è§£æ‰«æ**ï¼šé€šè¿‡ `AnnotationScanner.java` è‡ªåŠ¨æ‰«ææƒ³è¦çš„æ³¨è§£

  ```java
  // ç¤ºä¾‹ï¼šæ‰«æç‰¹å®šæ³¨è§£çš„ç±»
  public static Set<Class<?>> getClassesWithAnnotation(Class<?> annotation) {
      // å®ç°ç»†èŠ‚...
  }
  ```

- **åº”ç”¨åœºæ™¯**ï¼š
  - å®šæ—¶ä»»åŠ¡é…ç½®
  - æƒé™æ¥å£å‘ç°

### ç•Œé¢ä¼˜åŒ–

![æƒé™ç®¡ç†ç•Œé¢](./images/image-20250428223816172.png)
![è§’è‰²ç®¡ç†ç•Œé¢](./images/image-20250428223843974.png)

## :tipping_hand_man:ç”¨æ³•æç¤º

> [!TIP]
>
> å¤šè¯­è¨€ä½¿ç”¨æç¤ºï¼š
>
> è™½ç„¶ç›´æ¥è®©ç”¨æˆ·æ“ä½œJSONæ–‡ä»¶æœ‰ä¸€å®šé—¨æ§›ï¼ˆå¤šæ•°ç”¨æˆ·ä¸ç†Ÿæ‚‰JSONæ ¼å¼ï¼‰ï¼Œä½†åœ¨å¤šè¯­è¨€é¡¹ç›®å¼€å‘ä¸­ï¼ŒJSONæ ¼å¼å…·æœ‰ç‹¬ç‰¹ä¼˜åŠ¿ï¼š
>
> 1. ç»“æ„åŒ–ç‰¹æ€§ - çº¯æ–‡æœ¬æ ¼å¼ä¾¿äºAIè§£æå¤„ç†
> 2. é«˜æ•ˆç¿»è¯‘æµç¨‹ï¼š
>    - å¼€å‘è€…åªéœ€å®Œæˆä¸­æ–‡ç‰ˆæœ¬
>    - ä¸Šä¼ JSONæ–‡ä»¶è‡³AIç¿»è¯‘å·¥å…·
>    - ç®€å•æŒ‡ä»¤å³å¯æ‰¹é‡ç”Ÿæˆè‹±æ–‡/ç¹ä½“ä¸­æ–‡/éŸ©è¯­ç­‰ç‰ˆæœ¬
> 3. æ˜¾è‘—èŠ‚çœå¼€å‘æ—¶é—´ - å®ç°"ä¸€æ¬¡ç¼–å†™ï¼Œå¤šè¯­è¨€é€‚é…"çš„é«˜æ•ˆå·¥ä½œæµ

## ğŸ” æƒé™æ§åˆ¶ä½“ç³»

![image-20250428225337843](./images/image-20250428225337843-1745854181492-5.png)

### è®¿é—®è§„åˆ™é…ç½®

é€šè¿‡ `WebSecurityConfig` é…ç½®

| è·¯å¾„ç±»å‹ | ç¤ºä¾‹              | è®¿é—®è¦æ±‚ | é…ç½®æ–¹å¼                  |
| -------- | ----------------- | -------- | ------------------------- |
| å…¬å¼€æ¥å£ | `/api/public/**`  | æ— éœ€è®¤è¯ | è·¯å¾„åŒ…å« `public` å…³é”®å­—  |
| ç§æœ‰æ¥å£ | `/api/private/**` | éœ€ç™»å½•   | è·¯å¾„åŒ…å« `private` å…³é”®å­— |

### è·¯å¾„åŒ¹é…ç­–ç•¥

```java
public static String[] annotations = { ... };

// é…ç½®ç¤ºä¾‹
http.authorizeHttpRequests(auth -> auth
    .authorizeHttpRequests(authorize -> authorize
    .requestMatchers(annotations).permitAll()
);
```

### Mavenå·¥ç¨‹ç»“æ„

```mermaid
graph TD

çˆ¶å·¥ç¨‹ -->|ä¸»é¡¹ç›®| auth-api
çˆ¶å·¥ç¨‹ -->|ä»£ç ç”Ÿæˆå™¨| generator-code
auth-api -->|å¯åŠ¨é¡¹ã€æ§åˆ¶å™¨| service
service -->|mapper| dao
service -->|åŒ…å«domainã€é…ç½®ç­‰| auth-core
dao -->|åŒ…å«domainã€é…ç½®ç­‰| auth-code


```

## ğŸ› ï¸ åº”ç”¨åœºæ™¯

### 1. çº¯å‰ç«¯æ§åˆ¶æ¨¡å¼

å‰ç«¯åŸç†è¯¦æƒ…æŸ¥çœ‹Pureæ–‡æ¡£ï¼šhttps://pure-admin.cn/pages/RBAC/#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE

![image-20250428230444403](./images/image-20250428230444403-1745854157395-3.png)

- **é¡µé¢æ§åˆ¶**ï¼š
  1. ä¸ºè·¯ç”±èœå•åˆ†é…è§’è‰²
  2. ä¸ºç”¨æˆ·åˆ†é…è§’è‰²
- **æŒ‰é’®æ§åˆ¶**ï¼š
  ```ts
  // å‰ç«¯æƒé™ç é…ç½®
  const auth = {
    add: ['i18nType::add'],
    update: ['i18nType::update'],
    delete: ['i18nType::delete'],
  };
  ```

### 2. çº¯åç«¯æ§åˆ¶æ¨¡å¼

- æ¥å£çº§æƒé™ï¼šåˆ†é¡µè¿™ç§å°±å¯ä»¥æ·»åŠ ä¸º`/api/permission/*/*`

  ```java
  @Tag(name = "ç³»ç»Ÿæƒé™")
  @RestController
  @RequestMapping("api/permission")
  public class PermissionController {
      @Operation(summary = "åˆ†é¡µæŸ¥è¯¢", tags = {"permission::page"})
      @GetMapping("{page}/{limit}")
      public Result<PageResult<PermissionVo>> getPermissionPage(
          @PathVariable Integer page,
          @PathVariable Integer limit) {
          // ...
      }
  }
  ```

### 3. å…¨æ ˆæ§åˆ¶æ¨¡å¼

å‰ä¸¤ä¸ªç»“åˆ

## ğŸ›¡ï¸ å®‰å…¨é…ç½®

### è·¯å¾„åŒ¹é…ç­–ç•¥

AntPathè¯¦æƒ…ï¼šhttps://juejin.cn/spost/7498247273660743732

| æ¨¡å¼     | ç¤ºä¾‹            | è¯´æ˜             |
| -------- | --------------- | ---------------- |
| ç²¾ç¡®åŒ¹é… | `/api/user`     | å®Œå…¨åŒ¹é…è·¯å¾„     |
| é€šé…ç¬¦   | `/api/user/*`   | åŒ¹é…å•çº§è·¯å¾„     |
| å¤šçº§é€šé… | `/api/user/**`  | åŒ¹é…å¤šçº§è·¯å¾„     |
| æ–¹æ³•é™å®š | `GET /api/user` | åŒ¹é…ç‰¹å®šHTTPæ–¹æ³• |

## ğŸ§° æŠ€æœ¯æ ˆ

### å‰ç«¯

- Vue 3 + PureAdmin æ¨¡æ¿
- è‡ªå®šä¹‰æƒé™ç»„ä»¶
- å›½é™…åŒ–æ”¯æŒ

### åç«¯

- Spring Boot 3 + Spring Security 6
- JDK 17
- MySQL + Redis + MinIO
- Swagger + Knife4j æ–‡æ¡£

### å¼€å‘ç¯å¢ƒ

æ ¹æ®ä¸åŒdocker å¯åŠ¨æ–¹å¼ä¸ä¸€æ ·

```bash
# ä¸€é”®å¯åŠ¨ä¾èµ–æœåŠ¡
docker-compose up -d
# æ–°ç‰ˆçš„docker
docker compose up -d
```

## ğŸ“š æœ€ä½³å®è·µ

1. **æ³¨è§£è§„èŒƒ**ï¼š
   ```java
   @Tag(name = "æ¨¡å—åç§°", description = "æ¨¡å—æè¿°")
   @Operation(summary = "æ¥å£æ‘˜è¦", tags = {"æƒé™ç "})
   // æˆ–è€…
   @Operation(summary = "æ¥å£æ‘˜è¦", tags = "æƒé™ç ")
   ```
2. **æƒé™ç è®¾è®¡**ï¼š

   - æ¨¡å—::æ“ä½œ (å¦‚ `user::create`)
   - åˆ†å±‚çº§è®¾è®¡ (å¦‚ `system:user:update`)

3. **æ‰¹é‡æ“ä½œ**ï¼š
   - ä½¿ç”¨ Excel/JSON ç®¡ç†å¤§é‡æƒé™é…ç½®
   - å®šæœŸå¤‡ä»½æƒé™é…ç½®

## ğŸŒŸ é¡¹ç›®ä¼˜åŠ¿

1. **çœŸæ­£çš„åŠ¨æ€æ§åˆ¶** - æ— éœ€ç¡¬ç¼–ç æƒé™é€»è¾‘
2. **çµæ´»çš„æ•°æ®å¯¼å…¥** - æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼
3. **ç»†ç²’åº¦æ§åˆ¶** - ä»é¡µé¢åˆ°æŒ‰é’®çš„å¤šå±‚çº§æƒé™
4. **ç°ä»£åŒ–æŠ€æœ¯æ ˆ** - åŸºäºæœ€æ–° Spring ç”Ÿæ€
5. **å¼€ç®±å³ç”¨** - æä¾›å®Œæ•´ Docker éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. å¤šè¯­è¨€æ›´æ–°ä¼šå®Œå…¨æ›¿æ¢ç°æœ‰é…ç½®
2. ç”Ÿäº§ç¯å¢ƒå»ºè®®ç¦ç”¨ Swagger ç«¯ç‚¹
3. å¤æ‚æƒé™å»ºè®®ä½¿ç”¨ Excel æ‰¹é‡ç®¡ç†

## ğŸ“ˆ åç»­è§„åˆ’

- [ ] æƒé™çº§åˆ«æ‹–æ‹½
- [ ] æƒé™æ ‘å‹ç»“æ„åŠ¨æ€æ·»åŠ ã€æ›´æ–°ã€åˆ é™¤
- [ ] ç”¨æˆ·è®¾ç½®æŒä¹…åŒ–å­˜å‚¨åˆ°æ•°æ®åº“
- [ ] æƒé™å¼¹çª—é¡µé¢ä¼˜åŒ–
- [x] åç«¯æ–‡æ¡£æ³¨é‡Šå®Œå–„
- [x] ç³»ç»Ÿç›‘æ§åç«¯è¿”å›403åœæ­¢è¯·æ±‚
- [x] ä¼˜åŒ–ç”¨æˆ·é…ç½®æƒé™é€»è¾‘ï¼Œé…ç½®åçƒ­æ›´æ–°é€»è¾‘ç­‰
- [x] å®Œå–„åç«¯æ³¨é‡Šï¼Œæœ‰éœ€è¦æ·»åŠ ReadMeæ–‡æ¡£
- [ ] Redisä¸­è·å–æ´»è·ƒç”¨æˆ·

## å‰åç«¯æ¥å£è§„èŒƒ

### å‰ç«¯ç¤ºä¾‹è§„èŒƒ

| **æ“ä½œ** | **API å±‚**    | **Pinia å±‚**    |
| :------- | :------------ | :-------------- |
| æŸ¥è¯¢å•ä¸ª | `getUser`     | `loadUser`      |
| æŸ¥è¯¢åˆ—è¡¨ | `getUserList` | `loadUserList`  |
| åˆ†é¡µæŸ¥è¯¢ | `getUserPage` | `fetchUserPage` |
| æ–°å¢æ•°æ® | `createUser`  | `addUser`       |
| æ›´æ–°æ•°æ® | `updateUser`  | `editUser`      |
| åˆ é™¤æ•°æ® | `deleteUser`  | `removeUser`    |

### åç«¯æ¥å£ç¤ºä¾‹è§„èŒƒ

éµå¾ªRestful

| **æ“ä½œ** | **RESTful**                 |
| :------- | :-------------------------- |
| æŸ¥è¯¢åˆ—è¡¨ | `GET /users`                |
| åˆ†é¡µæŸ¥è¯¢ | `GET /users/{page}/{limit}` |
| æŸ¥è¯¢å•ä¸ª | `GET /users/{id}`           |
| æ–°å¢     | `POST /users`               |
| æ›´æ–°     | `PUT /users/{id}`           |
| åˆ é™¤     | `DELETE /users/{id}`        |

![wx_alipay](./images/wx_alipay.png)
